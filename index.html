<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ø§Ù„Ø¶Ø§Ø¦Ø¹</title>
<style>
body {margin:0; background: linear-gradient(180deg,#071124 0%, #0d2130 100%); color:#e6eef6; font-family: Arial, sans-serif; text-align:center; font-size:24px;}
.page { display: none; padding: 20px; }
.active { display: block; }
input, textarea { padding: 12px; border-radius: 6px; border: 1px solid #1e2a44; width: 80%; background: #0f172a; color: #e6eef6; font-size:22px; }
button { padding: 14px 24px; margin: 10px; border-radius: 8px; border: none; background: #06b6d4; color: #012; cursor: pointer; font-size:22px; }
.big { font-size: 30px; font-weight: bold; margin: 20px 0; }
table { margin: auto; border-collapse: collapse; font-size:24px; }
th, td { border: 1px solid #06b6d4; padding: 10px 18px; }
th { background-color: #012; }
td { background-color: #0f172a; }
</style>
</head>
<body>

<div id="home" class="page active">
<h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ø§Ù„Ø¶Ø§Ø¦Ø¹</h1>
<input id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨"><br><br>
<button onclick="addPlayer()">Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>
<ul id="playersList"></ul>
<button onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="gamePage" class="page">
<div class="big">Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: <span id="currentPlayerName"></span></div>
<div>Ø§Ø¶ØºØ· Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø±Ø¤ÙŠØ© ØºØ±Ø¶Ùƒ</div>
<button onclick="nextPlayer()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<div id="votePage" class="page">
<div id="voteTitle" class="big"></div>
<ul id="voteList"></ul>
</div>

<div id="impostorGuess" class="page">
<div class="big" id="impostorNameShow"></div>
<input id="guessInput" placeholder="Ø§ÙƒØªØ¨ ØªÙˆÙ‚Ø¹Ùƒ">
<button onclick="submitGuess()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<div id="scorePage" class="page">
<h2>Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
<table>
<thead><tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr></thead>
<tbody id="scoreTable"></tbody>
</table>
<button onclick="newGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
</div>

<script>
// ğŸ”¥ Ù…ÙƒØ§Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª
const toolPairs = [
    ["Ù‚Ù„Ù… Ø±ØµØ§Øµ", "Ù‚Ù„Ù… Ø­Ø¨Ø±"],
    ["Ø¬ÙˆØ§Ù„", "ØªØ§Ø¨Ù„Øª"],
    ["ØªÙØ§Ø­Ø©", "Ù…ÙˆØ²Ø©"],
    ["ÙƒØªØ§Ø¨", "Ø¯ÙØªØ±"],
    ["Ø§Ù„ØµÙŠÙ", "Ø§Ù„Ø´ØªØ§Ø¡"],
    ["Ø¨Ù„Ø§ÙŠØ³ØªØ§ÙŠØ´Ù†", "Ø§ÙƒØ³ Ø¨ÙˆÙƒØ³"],
    ["Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", "Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"],
    ["ÙƒÙ†ØªØ§ÙƒÙŠ", "Ù…Ø§ÙƒØ¯ÙˆÙ†Ø§Ù„Ø¯Ø²"],
    ["Ø¹Ù…", "Ø®Ø§Ù„"],
    ["Ø§Ø¨", "Ø§Ù…"],
    ["Ø¨ÙŠØ¨Ø³ÙŠ", "ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§"],
    ["Ù…ÙŠØ³ÙŠ", "Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ"],
    ["ØºØ§Ø¨Ø©", "Ù…Ø²Ø±Ø¹Ø©"],
    ["Ø¨Ø±", "Ù…Ø®ÙŠÙ…"],
    ["ÙŠÙˆØªÙŠÙˆØ¨", "ØªÙŠÙƒ ØªÙˆÙƒ"],
    ["Ø·Ø¨ÙŠØ¨", "ØµÙŠØ¯Ù„ÙŠ"]
];


let players = [];
let playerPoints = {};
let chosenPair = [];
let storyTool = "";
let impostorTool = "";
let impostorIndex = -1;
let currentIndex = 0;

// Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function addPlayer(){
    const name = playerName.value.trim();
    if(!name) return;
    players.push(name);
    if(!(name in playerPoints)) playerPoints[name]=0;
    updatePlayerList();
    playerName.value="";
}
function updatePlayerList(){
    playersList.innerHTML="";
    players.forEach(p=>{ const li=document.createElement("li"); li.textContent=p; playersList.appendChild(li); });
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
function startGame(){
    if(players.length<3){ alert("Ù„Ø§Ø²Ù… 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }
    chosenPair = toolPairs[Math.floor(Math.random()*toolPairs.length)];
    impostorIndex = Math.floor(Math.random()*players.length);
    if(Math.random()<0.5){ storyTool=chosenPair[0]; impostorTool=chosenPair[1]; } else { storyTool=chosenPair[1]; impostorTool=chosenPair[0]; }
    currentIndex=0;
    showPlayer();
}

function showSection(id){ document.querySelectorAll(".page").forEach(p=>p.classList.remove("active")); document.getElementById(id).classList.add("active"); }

function showPlayer(){
    if(currentIndex>=players.length){ startVoting(); return; }
    currentPlayerName.textContent=players[currentIndex];
    showSection("gamePage");
}

function nextPlayer(){
    const pIndex=currentIndex;
    alert("ØºØ±Ø¶Ùƒ: "+(pIndex===impostorIndex?impostorTool:storyTool));
    currentIndex++;
    showPlayer();
}

// Ø§Ù„ØªØµÙˆÙŠØª
let voteTurn=0;
let voteChosen={};
function startVoting(){ voteTurn=0; voteChosen={}; showVoteTurn(); showSection("votePage"); }

function showVoteTurn(){
    voteList.innerHTML="";
    if(voteTurn>=players.length){ showVoteResult(); return; }
    let voter=players[voteTurn];
    voteTitle.textContent=`${voter}ØŒ ØªØ¨ÙŠ ØªØµÙˆØª Ø¹Ù„Ù‰ Ù…Ù†ÙˆØŸ`;
    players.forEach(p=>{
        if(p!==voter){
            const li=document.createElement("li");
            li.textContent=p;
            li.onclick=()=>{
                voteChosen[p]=voteChosen[p]||[];
                voteChosen[p].push(voter);
                voteTurn++;
                showVoteTurn();
            };
            voteList.appendChild(li);
        }
    });
}

// Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØµÙˆÙŠØª
function showVoteResult(){
    alert("Ø§Ù„Ø£Ù…Ø¨ÙˆØ³ØªØ± Ù‡Ùˆ: "+players[impostorIndex]);

    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙˆÙŠØª
    for(let target in voteChosen){
        voteChosen[target].forEach(voter=>{
            if(voter===players[impostorIndex]) return; // Ø§Ù„Ø£Ù…Ø¨ÙˆØ³ØªØ± Ù„Ø§ ÙŠØ§Ø®Ø° Ù†Ù‚Ø§Ø· Ù…Ù† ØªØµÙˆÙŠØªÙ‡
            if(target===players[impostorIndex]){
                playerPoints[voter]+=100; // Ø§Ù„Ù…ÙˆØ§Ø·Ù† ØµØ­ ØµÙˆØª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø¨ÙˆØ³ØªØ±
            }
        });
    }

    impostorNameShow.textContent=`${players[impostorIndex]}ØŒ Ø­Ø§ÙˆÙ„ ØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ù„ÙØ©`;
    showSection("impostorGuess");
}

// ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø£Ù…Ø¨ÙˆØ³ØªØ±
function submitGuess(){
    const guess=document.getElementById("guessInput").value.trim();
    if(guess===storyTool){ // ØªØ®Ù…ÙŠÙ† ØµØ­
        playerPoints[players[impostorIndex]]+=100;
    }
    showScores();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·
function showScores(){
    scoreTable.innerHTML="";
    for(let p of players){
        const tr=document.createElement("tr");
        const tdName=document.createElement("td"); tdName.textContent=p;
        const tdPoints=document.createElement("td"); tdPoints.textContent=playerPoints[p];
        tr.appendChild(tdName); tr.appendChild(tdPoints);
        scoreTable.appendChild(tr);
    }
    showSection("scorePage");
}

// Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
function newGame(){
    currentIndex=0; voteTurn=0; voteChosen={}; impostorIndex=-1;
    showSection("home"); updatePlayerList();
    document.getElementById("guessInput").value="";
}
</script>

</body>
</html>
